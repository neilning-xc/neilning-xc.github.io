---
title: å¸¸è§åŠ å¯†ç®—æ³•åŠå…¶ä½¿ç”¨
author: Neil Ning
date: 2024-12-09 23:08:54
tags: ['MD5', 'SHA', 'RSA', 'AES', 'DES', 'DES']
categories: å­¦ä¹ 
cover: bg.jpeg
---
# å¸¸è§å“ˆå¸Œã€ç­¾åå’ŒåŠ å¯†ç®—æ³•

## å‰è¨€
åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æˆ–å¤šæˆ–å°‘éƒ½è§è¿‡æˆ–è€…å¬è¿‡ä¸€äº›å…³äºè®¡ç®—å“ˆå¸Œï¼Œç­¾åå’ŒåŠ å¯†çš„ç®—æ³•ã€‚è¿™äº›ç®—æ³•åœ¨è®¡ç®—æœºé¢†åŸŸä¸­æœ‰ç€éå¸¸é‡è¦çš„åœ°ä½ï¼Œä¸åŒçš„ç®—æ³•ä¹Ÿéƒ½æœ‰ä¸åŒçš„è‹±æ–‡åç§°ï¼Œæ¯”å¦‚MD5ã€SHA-1ã€RSAã€AESç­‰ç­‰ã€‚æ¯æ¬¡çœ‹åˆ°è¿™äº›ç®—æ³•éƒ½ä¼šæœ‰ä¸€ç§ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ï¼Œä½†æ˜¯å…·ä½“å±äºå“ªä¸€ç±»ç®—æ³•ï¼Œåˆæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Œå´å¾ˆéš¾è¯´æ¸…æ¥šã€‚æœ¬æ–‡å°†å¯¹è¿™äº›å¸¸è§çš„ç®—æ³•è¿›è¡Œä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œå¸Œæœ›èƒ½å¤Ÿç†æ¸…è¿™äº›ç®—æ³•ä¹‹é—´çš„å…³ç³»ã€‚æ–‡ä¸­ä¹Ÿä¼šä½¿ç”¨Nodejsçš„cryptoæ¨¡å—æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è¿™äº›ç®—æ³•ã€‚

## å“ˆå¸Œç®—æ³•
é¦–å…ˆä»æœ€å®¹æ˜“ç†è§£çš„å“ˆå¸Œç®—æ³•å¼€å§‹ã€‚**å“ˆå¸Œç®—æ³•æ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„è¾“å…¥æ•°æ®è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„è¾“å‡ºæ•°æ®çš„ç®—æ³•ã€‚**å®ƒçš„ç‰¹ç‚¹æ˜¯ä¸åŒçš„è¾“å…¥ä¼šå¾—åˆ°ä¸åŒçš„è¾“å‡ºï¼Œç›¸åŒçš„è¾“å…¥ï¼Œä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œå¹¶ä¸”è¾“å‡ºæ˜¯ä¸å¯é€†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ˆå¸Œç®—æ³•æ˜¯ä¸€ç§å•å‘çš„ç®—æ³•ï¼Œåªèƒ½ä»è¾“å…¥å¾—åˆ°è¾“å‡ºï¼Œä¸èƒ½ä»è¾“å‡ºå¾—åˆ°è¾“å…¥ã€‚

å“ˆå¸Œç®—æ³•æœ€å¸¸è§çš„æ˜¯åº”ç”¨åœ¨æ–‡ä»¶ä¼ è¾“ä¸­ï¼Œå¯ä»¥å¯¹ä»»æ„é•¿åº¦çš„æ–‡ä»¶æ•°æ®è®¡ç®—å“ˆå¸Œå€¼ï¼Œä»¥éªŒè¯æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚å¸¸è§çš„å“ˆå¸Œç®—æ³•æœ‰MD5ã€SHA-1ã€SHA-256ç­‰ç­‰ã€‚ä¸åŒçš„ç®—æ³•å¾—åˆ°çš„å“ˆå¸Œå€¼é•¿åº¦ä¸åŒï¼Œæ¯”å¦‚MD5çš„å“ˆå¸Œå€¼é•¿åº¦æ˜¯128ä½ï¼ŒSHA-1çš„å“ˆå¸Œå€¼é•¿åº¦æ˜¯160ä½ã€‚å“ˆå¸Œç®—æ³•çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
const crypto = require('crypto');

const password = 'qwertyuiop';

const md5 = crypto.createHash('md5');
md5.update(password);
const encryptedPassword = md5.digest('hex');
console.log(encryptedPassword);  // 6eea9b7ef19179a06954edd0f6c05ceb
```

updateæ–¹æ³•ç”¨äºè¾“å…¥æ•°æ®ï¼Œé™¤äº†å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯Bufferã€TypedArrayã€DataViewç­‰æ•°æ®ç±»å‹ã€‚digestæ–¹æ³•ç”¨äºè¾“å‡ºå“ˆå¸Œå€¼ï¼Œå‚æ•°å¯ä»¥æ˜¯`hex`ã€`base64`ã€`latin1`ç­‰ï¼Œè¡¨ç¤ºè¾“å‡ºçš„ç¼–ç æ ¼å¼ã€‚å¸¸è§çš„è¾“å‡ºæ ¼å¼æ˜¯hexï¼Œå³16è¿›åˆ¶ç¼–ç ã€‚

è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„å“ˆå¸Œç®—æ³•ï¼Œæ¯”å¦‚SHA-1ã€SHA-256ç­‰ï¼Œåªéœ€è¦å°†`createHash`æ–¹æ³•çš„å‚æ•°æ”¹ä¸ºå¯¹åº”çš„ç®—æ³•åç§°å³å¯ã€‚

```javascript
const crypto = require('crypto');

const password = 'qwertyuiop';
const sha = crypto.createHash('sha256');
sha.update(password);
const encryptedPassword = sha.digest('hex');
console.log(encryptedPassword); // 9a900403ac313ba27a1bc81f0932652b8020dac92c234d98fa0b06bf0040ecfd
```
é‚£å¦‚ä½•å¯¹æ–‡ä»¶è¿›è¡Œå“ˆå¸Œè®¡ç®—å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨Nodejsçš„fsæ¨¡å—æ¥è¯»å–æ–‡ä»¶æ•°æ®ï¼Œç„¶åè®¡ç®—å“ˆå¸Œå€¼ã€‚ç”±äºæ–‡ä»¶æ•°æ®å¯èƒ½æ¯”è¾ƒå¤§ï¼Œä¸é€‚åˆä¸€æ¬¡æ€§è¯»å–ï¼Œå¯ä»¥ä½¿ç”¨æµçš„æ–¹å¼æ¥è¯»å–æ–‡ä»¶æ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š

```javascript
const crypto = require('crypto');
const fs = require('fs');

const hash = crypto.createHash('md5');
const stream = fs.createReadStream('test.png');

stream.on('data', function(data) {
  hash.update(data);
});

stream.on('end', function() {
  console.log(hash.digest('hex')); // a1fe07317fe10f97cfb2e2a9e65cb46f
});
```
æˆ–è€…é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥ç®€åŒ–ä»£ç ï¼š

```javascript
const crypto = require('crypto');
const fs = require('fs');

const hash = crypto.createHash('md5');
const stream = fs.createReadStream('test.png');

stream.on('readable', function() {
  const data = stream.read();
  if (data) {
    hash.update(data);
  } else {
    console.log(hash.digest('hex')); // a1fe07317fe10f97cfb2e2a9e65cb46f
  }
});
```
æˆ–è€…è¿˜å¯ä»¥ä½¿ç”¨`pipe`æ–¹æ³•æ¥å®ç°ï¼š

```javascript
const crypto = require('crypto');
const fs = require('fs');
const { Writable } = require('stream');

const hash = crypto.createHash('md5');
const stream = fs.createReadStream('test.png');
const writable = new Writable({
  write(chunk, encoding, callback) {
    hash.update(chunk);
    callback();
  },
  final() {
    console.log(hash.digest('hex')); // a1fe07317fe10f97cfb2e2a9e65cb46f
  }
});
stream.pipe(hash).pipe(writable);
```

## hmacç®—æ³•
ä¸Šé¢çš„hashç®—æ³•æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œä¸èƒ½ç”¨äºéªŒè¯æ•°æ®çš„æ¥æºã€‚å¦‚æœä½¿ç”¨hashç®—æ³•æ¥å­˜å‚¨å¯†ç ï¼Œä¼šæœ‰hashç¢°æ’çš„é—®é¢˜ã€‚é»‘å®¢å¯ä»¥ä½¿ç”¨å½©è™¹è¡¨æ¥ç ´è§£å¯†ç ã€‚å½©è™¹è¡¨æ˜¯ä¸€ç§é¢„å…ˆè®¡ç®—å¥½çš„hashå€¼å’Œæ˜æ–‡çš„å¯¹åº”å…³ç³»è¡¨ã€‚é»‘å®¢å¯ä»¥é€šè¿‡hashå€¼æŸ¥æ‰¾å¯¹åº”çš„æ˜æ–‡ï¼Œä»è€Œç ´è§£å¯†ç ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨hmacç®—æ³•ã€‚**hmacç®—æ³•æ˜¯ä¸€ç§å¸¦æœ‰å¯†é’¥çš„å“ˆå¸Œç®—æ³•ï¼Œå¯ä»¥ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºã€‚**å¯ä»¥çœ‹ä½œæ˜¯ä¸Šé¢çš„md5ç®—æ³•çš„å¢å¼ºç‰ˆï¼Œhmacç®—æ³•çš„å…¨ç§°æ˜¯Hash-based Message Authentication Codeï¼Œå®ƒçš„è®¡ç®—æ–¹å¼æ˜¯å°†å¯†é’¥å’Œæ•°æ®è¿›è¡Œæ··åˆï¼Œç„¶åå†è®¡ç®—å“ˆå¸Œå€¼ã€‚è¿™æ ·ï¼Œå³ä½¿æ•°æ®æ³„éœ²ï¼Œé»‘å®¢ä¹Ÿæ— æ³•ä¼ªé€ æ•°æ®ï¼Œå› ä¸ºé»‘å®¢ä¸çŸ¥é“å¯†é’¥ã€‚ä»–çš„ä½¿ç”¨æ–¹å¼å’Œhashç®—æ³•ç±»ä¼¼ï¼Œåªæ˜¯éœ€è¦ä¼ å…¥å¯†é’¥ã€‚

```javascript
const crypto = require('crypto');

const secret = 'abcdefg'; // å¯†é’¥
const password = 'qwertyuiop';
const hash = crypto.createHmac('sha256', secret);
hash.update(password);
const encryptedPassword = hash.digest('hex');
console.log(encryptedPassword); // 566f3cdadb9e1f4543e0ad030c1996fccb68e530356e4563c75c20a470fb23d1
```

åªè¦å¯†é’¥ä¸åŒï¼Œå³ä½¿ç›¸åŒçš„æ•°æ®ï¼Œä¹Ÿä¼šå¾—åˆ°ä¸åŒçš„å“ˆå¸Œå€¼ã€‚è¿™æ ·å°±å¯ä»¥é¿å…hashç¢°æ’çš„é—®é¢˜ã€‚
```javascript
const crypto = require('crypto');

for (let i = 0; i < 5; i++) {
  const secret = crypto.randomBytes(16).toString('hex'); // å¯†é’¥
  const password = 'qwertyuiop';
  const hash = crypto.createHmac('sha1', secret);
  hash.update(password);
  const encryptedPassword = hash.digest('hex');
  console.log(encryptedPassword);
}
```
å¤§æ–‡ä»¶æµçš„ä½¿ç”¨æ–¹å¼å’Œhashç®—æ³•ç±»ä¼¼ï¼Œåªæ˜¯éœ€è¦ä¼ å…¥å¯†é’¥ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

## å¯¹ç§°åŠ å¯†ç®—æ³•
åŠ å¯†ç®—æ³•å’Œä¸Šé¢çš„å“ˆå¸Œç®—æ³•å’Œhmacç®—æ³•ä¸åŒï¼Œå®ƒæ˜¯ä¸€ç§åŒå‘çš„ç®—æ³•ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚**å¯¹ç§°åŠ å¯†æŒ‡çš„æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒå¯†é’¥çš„ç®—æ³•ã€‚**å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰DESã€3DESã€AESç­‰ã€‚

cryptoæ¨¡å—ä½¿ç”¨`createCipheriv`æ–¹æ³•æ¥åˆ›å»ºåŠ å¯†å¯¹è±¡ï¼Œä½¿ç”¨`createDecipheriv`æ–¹æ³•æ¥åˆ›å»ºè§£å¯†å¯¹è±¡ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯
1. ç®—æ³•åç§°ï¼Œå¦‚`aes-128-cbc`ã€`aes-192-cbc`ã€`aes-256-cbc`ç­‰ï¼Œä¸­é—´çš„æ•°å­—è¡¨ç¤ºå¯†é’¥é•¿åº¦ï¼Œcbcè¡¨ç¤ºåŠ å¯†æ¨¡å¼ã€‚
2. å¯†é’¥ï¼Œé•¿åº¦å’Œç®—æ³•æœ‰å…³ï¼Œæ¯”å¦‚AESçš„å¯†é’¥é•¿åº¦å¯ä»¥æ˜¯128ä½ã€192ä½ã€256ä½ã€‚
3. åˆå§‹åŒ–å‘é‡ivã€‚å¯ä»¥æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œç”¨äºå¢åŠ åŠ å¯†å¼ºåº¦ã€‚ivçš„é•¿åº¦å’Œç®—æ³•æœ‰å…³ï¼Œæ¯”å¦‚AESçš„ivé•¿åº¦æ˜¯16å­—èŠ‚ï¼ˆ128ä½ï¼‰ï¼ŒDESçš„ivé•¿åº¦æ˜¯8å­—èŠ‚ã€‚ï¼ˆ64ä½ï¼‰

åŠ å¯†å’Œè§£å¯†è¿˜éœ€è¦è°ƒç”¨`update`æ–¹æ³•å’Œ`final`æ–¹æ³•ï¼Œ`update`æ–¹æ³•ç”¨äºè¾“å…¥æ•°æ®ï¼Œ`final`æ–¹æ³•ç”¨äºè¾“å‡ºæ•°æ®ã€‚`update`æ–¹æ³•ä¹Ÿéœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯
1. è¾“å…¥æ•°æ®
2. è¾“å…¥æ•°æ®çš„ç¼–ç æ ¼å¼ï¼Œå¯ä»¥æ˜¯`utf8`ã€`hex`ã€`base64`ç­‰
3. è¾“å‡ºæ•°æ®çš„ç¼–ç æ ¼å¼ï¼Œå¯ä»¥æ˜¯`hex`ã€`base64`ç­‰

`final`æ–¹æ³•åªéœ€è¦ä¼ å…¥è¾“å‡ºæ•°æ®çš„ç¼–ç æ ¼å¼å³å¯ã€‚

å¯¹ç§°åŠ å¯†çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
```javascript
function encrypt(text, key, iv) {
  const cipher = crypto.createCipheriv('aes-128-cbc', key, iv);
  let encrypted = cipher.update(text, 'utf8', 'hex');
  encrypted += cipher.final('hex');
  return encrypted;
}

function decrypt(encrypted, key, iv) {
  const decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);
  let decrypted = decipher.update(encrypted, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  return decrypted;
}

const password = 'qwertyuiop'; // æ˜æ–‡å¯†ç 
const key = '1234567890123456'; // å¯†é’¥ 128ä½
const iv = '1234567890123456'; // å‘é‡ 128ä½
const encrypted = encrypt(password, key, iv); // åŠ å¯†
console.log(encrypted); // 949cb01e787c29f7fa519ab2c9b98791

const decrypted = decrypt(encrypted, key, iv); // è§£å¯†
console.log(decrypted === password); // true
```
ä»¥ä¸Šä»£ç ä¸­ï¼Œ`encrypt`æ–¹æ³•ç”¨äºåŠ å¯†æ•°æ®ï¼Œ`decrypt`æ–¹æ³•ç”¨äºè§£å¯†æ•°æ®ã€‚åŠ å¯†å’Œè§£å¯†éƒ½éœ€è¦ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œå‘é‡ã€‚è¿™é‡Œçš„å¯†é’¥å’Œå‘é‡éƒ½æ˜¯å›ºå®šçš„ï¼Œå®é™…ä½¿ç”¨ä¸­ï¼Œå¯†é’¥å’Œå‘é‡åº”è¯¥æ˜¯éšæœºçš„ï¼Œå¯ä»¥ä½¿ç”¨`crypto.randomBytes`æ–¹æ³•ç”Ÿæˆã€‚


## éå¯¹ç§°åŠ å¯†ç®—æ³•
ä¸Šé¢çš„å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•å®‰å…¨åœ°ä¼ è¾“å¯†é’¥å‘¢ï¼Ÿå¦‚æœå¯†é’¥æ³„éœ²ï¼Œé‚£ä¹ˆåŠ å¯†å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚**éå¯¹ç§°åŠ å¯†ç®—æ³•ä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼Œåˆ†åˆ«æ˜¯å…¬é’¥å’Œç§é’¥ï¼Œå¯ä»¥ç”¨å…¬é’¥åŠ å¯†æ•°æ®ï¼Œç§é’¥è§£å¯†æ•°æ®ã€‚æˆ–è€…ç§é’¥åŠ å¯†æ•°æ®ï¼Œå…¬é’¥è§£å¯†æ•°æ®**ã€‚å…¬é’¥å¯ä»¥å…¬å¼€ï¼Œç§é’¥å¿…é¡»ä¿å¯†ã€‚å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰RSAã€DSAã€ECCç­‰ã€‚

ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•æ—¶ï¼Œéœ€è¦å…ˆç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œå¯ä»¥opensslå‘½ä»¤ç”Ÿæˆä¸€å¯¹å¯†é’¥æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨cryptoæ¨¡å—çš„`generateKeyPair`æ–¹æ³•ç”Ÿæˆä¸€å¯¹å¯†é’¥ã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§æ–¹å¼ã€‚

é¦–å…ˆæ˜¯ä½¿ç”¨opensslå‘½ä»¤ç”Ÿæˆä¸€å¯¹å¯†é’¥æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆä¸€å¯¹RSAå¯†é’¥æ–‡ä»¶ã€‚
```shell
openssl genrsa -out private.pem 1024 // ç”Ÿæˆç§é’¥æ–‡ä»¶
openssl rsa -in private.pem -pubout -out public.pem // ç”Ÿæˆå…¬é’¥æ–‡ä»¶
```
ä»¥ä¸Šå‘½ä»¤ç”Ÿæˆäº†PEMæ ¼å¼çš„ç§é’¥å’Œå…¬é’¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
```shell
$ cat private.pem
-----BEGIN RSA PRIVATE KEY-----
MIICXgIBAAKBgQDBO4jlIDpmIniRxMByRpVoEaQXsNjE3CF4wvoa8rbj6yVhESZA
kJMDv/Pgr5Ew9GUbASuT+9UEaSwnqUyatg24u5WnXNqMCsAGl657/sFw2yMvpXs5
gE+P0X8aPLghdy76x/PM0RmhMdVKLjsFmWbTUGUvfBZbJur8bs8E+IEYlwIDAQAB
AoGBAIDtRx6RjUV+NHIWE81reN5x/slrzoYy1gZsGVIHpa2WxF7qgVpM3DqBRagh
nD9MoXUOJ9RaD7wcrEBePmVvmOEAvSv2ucu1UpgFGwIy6i4a6oDmugvDvom4yjLT
l8C5+PEKZp4anXWnAyalqfgQIjJdNiPIbttbPD3dt4P2mRcxAkEA/WN4FtyVATQw
Cq3lKv41OsebzuMaW8szykWbmXoQtSn/t4FJIlRf0orwngA3jTlMA4fIoFTr1SjD
WSjYWlQkbwJBAMM5WjGCL7zMOVRsl2DCpbigf3CXao5G4+pNxWV917OUDZX9mNDs
I7FmqgvfjuH4n9EIgjCT6tNTvfPsyBDpclkCQQCld8hbPY68a4UX5DksGzdNfD4+
G0YCPa9DXrNexTyV4ahRAEdu+KRejEbXFxMv0QPXplsYgHxFBcqTtb2bNylXAkEA
haqXHp7MoLAT8MIJQ68CWM9LcoO56YCQPLTTGxJ2xfXw92mTYDjOl4B7nXWMFxxs
EGuK+EfO2LLVtFXDBhFQwQJAP/Y0GPDlYF5YfrkKjXaI7uWZ/KVnQcYaoaj/Pqrb
4pZ3wTB0RBcdDZz8oJ5xksf4/tpetigQgJlmaS/+vRBQLg==
-----END RSA PRIVATE KEY-----

$ cat public.pem
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDBO4jlIDpmIniRxMByRpVoEaQX
sNjE3CF4wvoa8rbj6yVhESZAkJMDv/Pgr5Ew9GUbASuT+9UEaSwnqUyatg24u5Wn
XNqMCsAGl657/sFw2yMvpXs5gE+P0X8aPLghdy76x/PM0RmhMdVKLjsFmWbTUGUv
fBZbJur8bs8E+IEYlwIDAQAB
-----END PUBLIC KEY-----
```
å…¬é’¥æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶éƒ½æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥è¯»å–ã€‚å…¶æ ¼å¼å¿…é¡»æ»¡è¶³ä¸€å®šçš„è§„èŒƒï¼Œä¸€èˆ¬éƒ½æœ‰`BEGIN XXX`å’Œ`END XXX`å¼€å¤´å’Œç»“å°¾ï¼Œä¸­é—´æ˜¯å¯†é’¥çš„å†…å®¹ã€‚å†…å®¹éƒ¨åˆ†æ¯è¡Œæ˜¯64ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨`\n`æ¢è¡Œã€‚ç¼–ç æ ¼å¼ä¸€èˆ¬æ˜¯base64ç¼–ç ã€‚

cryptoæ¨¡å—çš„éå¯¹ç§°åŠ å¯†ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
```javascript
const fs = require('fs');
const crypto = require('crypto');

const PUBLIC_KEY = fs.readFileSync('public.pem', 'utf8');
const PRIVATE_KEY = fs.readFileSync('private.pem', 'utf8');

const password = 'qwertyuiop'; // æ˜æ–‡å¯†ç 
// ä½¿ç”¨å…¬é’¥åŠ å¯†ã€ç§é’¥è§£å¯†
const encrypted = crypto.publicEncrypt(PUBLIC_KEY, Buffer.from(password));
console.log(encrypted.toString('hex'));
const decrypted = crypto.privateDecrypt(PRIVATE_KEY, encrypted);
console.log(decrypted.toString('utf8') === password); // true

// ä½¿ç”¨ç§é’¥åŠ å¯†ã€å…¬é’¥è§£å¯†
const encrypted2 = crypto.privateEncrypt(PRIVATE_KEY, Buffer.from(password));
console.log(encrypted2.toString('hex'));
const decrypted2 = crypto.publicDecrypt(PUBLIC_KEY, encrypted2);
console.log(decrypted2.toString('utf8') === password); // true
```

è¿˜å¯ä»¥ä½¿ç”¨cryptoæ¨¡å—çš„`generateKeyPair`æ–¹æ³•åˆ›å»ºå…¬é’¥å’Œç§é’¥ï¼Œè¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯:
1. ç®—æ³•åç§°ï¼Œå¦‚`rsa`ã€`dsa`ã€`ecc`ç­‰
2. é…ç½®å¯¹è±¡ï¼ŒåŒ…æ‹¬`modulusLength`ã€`publicExponent`ã€`namedCurve`ç­‰
3. å›è°ƒå‡½æ•°ï¼Œç”¨äºæ¥æ”¶ç”Ÿæˆçš„å¯†é’¥å¯¹

```javascript
const crypto = require('crypto');

crypto.generateKeyPair('rsa', {
  modulusLength: 2048,
  publicKeyEncoding: {
    type: 'spki',
    format: 'pem'
  },
  privateKeyEncoding: {
    type: 'pkcs8',
    format: 'pem',
    cipher: 'aes-256-cbc',
    passphrase: 'top secret'
  }
}, (err, publicKey, privateKey) => {
  if (err) {
    console.error('Error generating key pair:', err);
  } else {
    console.log('Public Key:', publicKey);
    console.log('Private Key:', privateKey);
  }
});
```
ç”Ÿæˆçš„å…¬é’¥å’Œç§é’¥å¯ä»¥ç›´æ¥ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚åŠ å¯†å’Œè§£å¯†çš„æ–¹å¼å’Œä¸Šé¢çš„æ–¹å¼ä¸€æ ·ã€‚

## ç­¾åç®—æ³•
è¿˜ç”¨ä¸€ç§å¸¸è§çš„ç®—æ³•æ˜¯ç­¾åç®—æ³•ã€‚**ç­¾åç®—æ³•æ˜¯ä¸€ç§ç”¨äºéªŒè¯æ•°æ®å®Œæ•´æ€§å’Œæ¥æºçš„ç®—æ³•ï¼Œå¯ä»¥å¯¹æ•°æ®ç”Ÿæˆæ•°å­—ç­¾åï¼Œä»¥é˜²æ­¢åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ã€‚**ç­¾åç®—æ³•å’Œå“ˆå¸Œç®—æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯å•å‘ä¸å¯é€†çš„ã€‚ä¸åŒçš„æ˜¯ï¼Œç­¾åç®—æ³•éœ€è¦ä½¿ç”¨ç§é’¥å¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œç„¶åä½¿ç”¨å…¬é’¥å¯¹ç­¾åè¿›è¡ŒéªŒè¯ã€‚ä¸”**åªèƒ½é€šè¿‡ç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯ç­¾å**ã€‚å¸¸è§çš„ç­¾åç®—æ³•æœ‰**RSA**ã€**DSA**ã€**ECDSA**ç­‰ã€‚ç­¾åç®—æ³•æœ€å¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯æ•°å­—è¯ä¹¦å’ŒJWTï¼ˆJWTè§„èŒƒå¯å‚è€ƒğŸ‘‰[è¿™é‡Œ](https://jwt.io/)ï¼‰ã€‚JWTçš„ç¬¬ä¸‰éƒ¨åˆ†å°±æ˜¯ç­¾åï¼Œç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ¥æºã€‚

Nodejsçš„cryptoæ¨¡å—çš„ç­¾åç®—æ³•ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
```javascript
const PUBLIC_KEY = fs.readFileSync('public.pem', 'utf8');
const PRIVATE_KEY = fs.readFileSync('private.pem', 'utf8');
const password = 'qwertyuiop'; // æ˜æ–‡å¯†ç 
const sign = crypto.createSign('RSA-SHA256') // åˆ›å»ºç­¾åå¯¹è±¡, æŒ‡å®šç­¾åç®—æ³•ï¼Œå¸¸è§çš„ç­¾åç®—æ³•æœ‰RSA-SHA256ã€RSA-SHA512ã€DSA-SHA1ç­‰
sign.update(password); // æŒ‡å®šç­¾åå†…å®¹
const signature = sign.sign(PRIVATE_KEY, 'hex'); // ç”Ÿæˆç­¾åï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè¾“å‡ºæ ¼å¼ä¸º'base64'ã€'base64url'ç­‰
console.log(signature);

const verify = crypto.createVerify('RSA-SHA256'); // åˆ›å»ºéªŒè¯å¯¹è±¡, æŒ‡å®šç®—æ³•ï¼Œå¿…é¡»å’Œç­¾åç®—æ³•ä¸€è‡´
verify.update(password); // æŒ‡å®šéªŒè¯å†…å®¹
const result = verify.verify(PUBLIC_KEY, signature, 'hex'); // éªŒè¯ç­¾åï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè¾“å…¥æ ¼å¼ä¸º'base64'ã€'base64url'ç­‰
console.log(result); // true
```

## DHç®—æ³•
DHç®—æ³•æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œè¯¥ç®—æ³•ä¸æ˜¯ç”¨æ¥åŠ å¯†æ•°æ®çš„ï¼Œè€Œæ˜¯åœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸­å®‰å…¨åœ°äº¤æ¢å¯†é’¥ã€‚DHç®—æ³•çš„å…¨ç§°æ˜¯Diffie-Hellmanç®—æ³•ï¼Œå®ƒçš„åŸç†æ˜¯é€šè¿‡æ•°å­¦è¿ç®—æ„é€ ä¸€ä¸ªå¤æ‚çš„æ•°å­¦éš¾é¢˜ï¼Œå¯¹è¯¥æ•°å­¦é—®é¢˜æ— æ³•åœ¨çŸ­æ—¶é—´å†…æœ‰æ•ˆçš„æ±‚è§£ã€‚DHç®—æ³•çš„è¿‡ç¨‹æ˜¯ï¼ŒåŒæ–¹å„è‡ªç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ï¼Œç„¶åé€šè¿‡å…¬é’¥äº¤æ¢ï¼Œæœ€åé€šè¿‡ç§é’¥è®¡ç®—å‡ºä¸€ä¸ªç›¸åŒçš„å¯†é’¥ã€‚è¿™ä¸ªå¯†é’¥åªæœ‰åŒæ–¹çŸ¥é“ï¼Œé»‘å®¢æ— æ³•çªƒå–ã€‚DHç®—æ³•çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
```javascript
const crypto = require('crypto');

const dh1 = crypto.createDiffieHellman(512);
const prime = dh1.getPrime(); // è·å–ç´ æ•°
const generator = dh1.getGenerator(); // è·å–ç”Ÿæˆå™¨
const publicKey1 = dh1.generateKeys(); // ç”Ÿæˆå…¬é’¥
console.log('Prime:', prime.toString('hex'));
console.log('Generator:', generator.toString('hex'));
console.log('Public Key1:', publicKey1.toString('hex'));

const dh2 = crypto.createDiffieHellman(prime, generator);
const publicKey2 = dh2.generateKeys(); // ç”Ÿæˆå…¬é’¥
console.log('Public Key2:', publicKey2.toString('hex'));

const secret1 = dh1.computeSecret(publicKey2); // ç”Ÿæˆå¯†é’¥
const secret2 = dh2.computeSecret(publicKey1); // ç”Ÿæˆå¯†é’¥
console.log('Secret1:', secret1.toString('hex'));
console.log('Secret2:', secret2.toString('hex'));
console.log(secret1.toString('hex') === secret2.toString('hex')); // true
```
åŒæ–¹ç”Ÿæˆç›¸åŒçš„å¯†é’¥ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥å¯†é’¥é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†é€šä¿¡äº†ã€‚


## å‚è€ƒèµ„æ–™
- [æ·±å…¥ç†è§£ node ä¸­çš„ crypto åŠ å¯†æ¨¡å—](https://www.xiabingbao.com/post/node/node-crypto.html)
- [Node.js crypto æ¨¡å—](https://liaoxuefeng.com/books/javascript/nodejs/basic-modules/crypto/)
